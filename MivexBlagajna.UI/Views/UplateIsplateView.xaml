<UserControl
    x:Class="MivexBlagajna.UI.Views.UplateIsplateView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:converters="clr-namespace:MivexBlagajna.UI.Converters"
    xmlns:syncfusion="http://schemas.syncfusion.com/wpf"
    d:DesignHeight="450"
    d:DesignWidth="800"
    mc:Ignorable="d">

    <UserControl.Resources>

        <CollectionViewSource x:Key="ComboBoxItems" Source="{Binding MestaTroska}"/>

        <converters:NullItemConverter x:Key="NullConverter" />

    </UserControl.Resources>

    <Grid>

        <Grid.RowDefinitions>

            <RowDefinition Height="auto" />
            <RowDefinition />

        </Grid.RowDefinitions>

        <Grid>

            <Border
                Width="auto"
                Height="auto"
                Margin="0,10"
                Background="#F7F8F8">

                <Border.Effect>
                    <DropShadowEffect
                        BlurRadius="5"
                        Direction="-90"
                        Opacity="0.1" />
                </Border.Effect>

                <Grid Margin="40,10">

                    <Grid.ColumnDefinitions>

                        <ColumnDefinition Width="auto" />
                        <ColumnDefinition Width="auto" />
                        <ColumnDefinition Width="auto" />
                        <ColumnDefinition Width="auto" />
                        <ColumnDefinition Width="auto" />
                        <ColumnDefinition />

                    </Grid.ColumnDefinitions>

                    <Grid Margin="10,0,10,0">

                        <Grid.RowDefinitions>

                            <RowDefinition Height="auto" />
                            <RowDefinition Height="auto" />
                            <RowDefinition Height="auto" />
                            <RowDefinition />

                        </Grid.RowDefinitions>

                        <StackPanel>
                            <Label Content="Datum" />
                            <syncfusion:DateTimeEdit
                                DateTime="{Binding Transakcija.Datum, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                DropDownView="Calendar"
                                IsEnabled="{Binding Transakcija.IsEditable, UpdateSourceTrigger=PropertyChanged, FallbackValue=False}" />
                        </StackPanel>

                        <StackPanel Grid.Row="1" Margin="0,10">
                            <Label Content="Konto" />

                            <syncfusion:ComboBoxAdv
                                Height="25"
                                VerticalAlignment="Center"
                                BorderThickness="0.5"
                                IsEnabled="{Binding Transakcija.IsEditable, UpdateSourceTrigger=PropertyChanged, FallbackValue=False}"
                                ItemsSource="{Binding Konta}"
                                SelectedValue="{Binding Transakcija.Konto_Id, Mode=TwoWay}"
                                SelectedValuePath="Id" />
                        </StackPanel>
                    </Grid>

                    <Grid Grid.Column="1" Margin="10,0,10,0">

                        <Grid.RowDefinitions>

                            <RowDefinition Height="auto" />
                            <RowDefinition Height="auto" />
                            <RowDefinition Height="auto" />
                            <RowDefinition />

                        </Grid.RowDefinitions>

                        <Grid>

                            <Grid.ColumnDefinitions>

                                <ColumnDefinition />
                                <ColumnDefinition />

                            </Grid.ColumnDefinitions>

                            <StackPanel>

                                <Label Content="Šifra" />

                                <syncfusion:SfTextBoxExt
                                    x:Name="SearchBox"
                                    Width="80"
                                    Height="25"
                                    VerticalAlignment="Center"
                                    BorderThickness="0.5"
                                    IsEnabled="{Binding Transakcija.IsEditable, UpdateSourceTrigger=PropertyChanged, FallbackValue=False}"
                                    TextChanged="SearchBox_TextChanged"/>

                            </StackPanel>

                            <StackPanel Grid.Column="1">

                                <Label Margin="20,0" Content="Komitent" />

                                <syncfusion:ComboBoxAdv
                                    x:Name="KomitentNaziv"
                                    Width="350"
                                    Height="25"
                                    Margin="20,0,0,0"
                                    VerticalAlignment="Center"
                                    BorderThickness="0.5"
                                    SelectedValue="{Binding Transakcija.Komitent_Id, Mode=TwoWay}"
                                    SelectedValuePath="Id"
                                    IsEnabled="{Binding Transakcija.IsEditable, UpdateSourceTrigger=PropertyChanged, FallbackValue=False}"
                                    SelectionChanged="KomitentNaziv_SelectionChanged">

                                    <b:Interaction.Triggers>
                                        <b:EventTrigger EventName="SelectionChanged">
                                            <b:InvokeCommandAction Command="{Binding SetFilterCommand}" CommandParameter="{Binding ElementName=KomitentNaziv, Path=SelectedItem}" />
                                        </b:EventTrigger>
                                    </b:Interaction.Triggers>

                                </syncfusion:ComboBoxAdv>

                            </StackPanel>

                        </Grid>

                        <Grid Grid.Row="1" Margin="0,10">

                            <Grid.ColumnDefinitions>

                                <ColumnDefinition />
                                <ColumnDefinition />

                            </Grid.ColumnDefinitions>

                            <StackPanel Margin="0,0,0,0">

                                <Label Content="Nalog" />

                                <syncfusion:SfTextBoxExt
                                    Width="80"
                                    Height="25"
                                    VerticalAlignment="Center"
                                    BorderThickness="0.5"
                                    IsEnabled="False"
                                    Text="{Binding Transakcija.Nalog, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                            </StackPanel>

                            <StackPanel Grid.Column="1">

                                <Label Margin="20,0" Content="Opis" />

                                <syncfusion:SfTextBoxExt
                                    Width="350"
                                    Height="25"
                                    Margin="20,0,0,0"
                                    VerticalAlignment="Center"
                                    BorderThickness="0.5"
                                    IsEnabled="{Binding Transakcija.IsEditable, UpdateSourceTrigger=PropertyChanged, FallbackValue=False}"
                                    Text="{Binding Transakcija.Opis, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                            </StackPanel>

                        </Grid>

                    </Grid>

                    <Grid Grid.Column="2" Margin="10,0,10,0">

                        <Grid.RowDefinitions>

                            <RowDefinition Height="auto" />
                            <RowDefinition Height="auto" />
                            <RowDefinition Height="auto" />
                            <RowDefinition />

                        </Grid.RowDefinitions>

                        <Grid>

                            <Grid.ColumnDefinitions>

                                <ColumnDefinition />
                                <ColumnDefinition />

                            </Grid.ColumnDefinitions>

                            <StackPanel>

                                <Label Content="Mesto troška" />
                                <syncfusion:ComboBoxAdv
                                    x:Name="mestaComboBox"
                                    Width="350"
                                    Height="25"
                                    VerticalAlignment="Center"
                                    BorderThickness="0.5"
                                    ItemsSource="{Binding MestaTroska}"
                                    SelectedItem="{Binding Transakcija.MestoTroska, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    SelectedValue="{Binding Transakcija.MestoTroska_Id, Mode=TwoWay}"
                                    SelectedValuePath="Id"
                                    IsEnabled="{Binding Transakcija.IsEditable, UpdateSourceTrigger=PropertyChanged, FallbackValue=False}">

                                </syncfusion:ComboBoxAdv>

                            </StackPanel>

                        </Grid>

                        <StackPanel
                            Grid.Row="1"
                            Margin="0,10"
                            Orientation="Horizontal">

                            <StackPanel Orientation="Vertical">
                                <Label Content="Vrsta naloga" IsEnabled="True" />

                                <syncfusion:ComboBoxAdv
                                    x:Name="Vrste"
                                    Width="200"
                                    Height="25"
                                    VerticalAlignment="Center"
                                    BorderThickness="0.5"
                                    IsEnabled="{Binding Transakcija.IsEditable, UpdateSourceTrigger=PropertyChanged, FallbackValue=False}"
                                    ItemsSource="{Binding VrsteNaloga}"
                                    SelectedValue="{Binding Transakcija.VrsteNaloga_Id, Mode=TwoWay}"
                                    SelectedValuePath="Id">

                                    <b:Interaction.Triggers>
                                        <b:EventTrigger EventName="SelectionChanged">
                                            <b:InvokeCommandAction Command="{Binding CreateBrojNalogaCommand}" CommandParameter="{Binding ElementName=Vrste, Path=SelectedItem}" />
                                        </b:EventTrigger>
                                    </b:Interaction.Triggers>

                                </syncfusion:ComboBoxAdv>

                            </StackPanel>
                        </StackPanel>

                    </Grid>

                    <Grid Grid.Column="3">

                        <Grid.RowDefinitions>

                            <RowDefinition Height="auto" />
                            <RowDefinition Height="auto" />
                            <RowDefinition Height="auto" />
                            <RowDefinition />

                        </Grid.RowDefinitions>

                        <Grid>

                            <Grid.ColumnDefinitions>

                                <ColumnDefinition Width="auto" />
                                <ColumnDefinition Width="auto" />
                                <ColumnDefinition />

                            </Grid.ColumnDefinitions>

                            <StackPanel>
                                <Label Content="Uplata" />
                                <syncfusion:SfTextBoxExt
                                    Width="150"
                                    Height="35"
                                    VerticalAlignment="Center"
                                    BorderThickness="0.5"
                                    IsEnabled="{Binding Transakcija.IsEditable, UpdateSourceTrigger=PropertyChanged, FallbackValue=False}"
                                    Text="{Binding Transakcija.Uplata, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    Watermark="0.00" />

                            </StackPanel>

                            <StackPanel Grid.Column="1" Margin="20,0,0,0">
                                <Label Content="Isplata" />
                                <syncfusion:SfTextBoxExt
                                    Width="150"
                                    Height="35"
                                    VerticalAlignment="Center"
                                    BorderThickness="0.5"
                                    IsEnabled="{Binding Transakcija.IsEditable, UpdateSourceTrigger=PropertyChanged, FallbackValue=False}"
                                    Text="{Binding Transakcija.Isplata, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    Watermark="0.00" />
                            </StackPanel>

                        </Grid>

                        <Grid Grid.Row="1" Margin="50,0">

                            <Grid.RowDefinitions>

                                <RowDefinition Height="auto" />
                                <RowDefinition />

                            </Grid.RowDefinitions>

                            <StackPanel Margin="0,25" Orientation="Horizontal">

                                <syncfusion:ButtonAdv
                                    Width="100"
                                    Label="Izmeni"
                                    SizeMode="Normal"
                                    Command="{Binding EditTransakcijaCommand}"
                                    SmallIcon="/Images/icons8-edit-property-48.png" 
                                    Click="novNalogOrEditBtn_Click"/>
                                <syncfusion:ButtonAdv
                                    Width="100"
                                    Margin="20,0"
                                    Label="Otkaži"
                                    SizeMode="Normal"
                                    Command="{Binding CancelCommand}"
                                    SmallIcon="/Images/icons8-unavailable-50.png" />

                            </StackPanel>

                        </Grid>

                    </Grid>

                    <Grid Grid.Column="4">

                        <Grid.RowDefinitions>

                            <RowDefinition />
                            <RowDefinition />
                            <RowDefinition />

                        </Grid.RowDefinitions>

                        <StackPanel Margin="10,10" Orientation="Horizontal">

                            <syncfusion:ButtonAdv
                                x:Name="novNalogBtn"
                                Command="{Binding CreateTransakcijaCommand}"
                                Label="Nov Nalog"
                                LargeIcon="/Images/icons8-add-48.png"
                                SizeMode="Large" 
                                Click="novNalogOrEditBtn_Click"/>

                            <syncfusion:ButtonAdv
                                Margin="20,0"
                                Label="Obriši unos"
                                LargeIcon="/Images/icons8-remove-48.png"
                                SizeMode="Large" 
                                Command="{Binding DeleteCommand}"/>

                        </StackPanel>

                        <syncfusion:ButtonAdv
                            Grid.Row="1"
                            Width="100"
                            Margin="0,0,20,0"
                            HorizontalAlignment="Stretch"
                            Command="{Binding SaveCommand}"
                            Label="Sačuvaj"
                            LargeIcon="/Images/icons8-save-48.png"
                            SizeMode="Large" 
                            Click="SaveButton_Click"/>

                    </Grid>

                    <Grid Grid.Column="5">

                        <Grid.RowDefinitions>

                            <RowDefinition />
                            <RowDefinition />
                            <RowDefinition />

                        </Grid.RowDefinitions>

                        <syncfusion:ButtonAdv
                            Grid.Row="0"
                            Width="150"
                            Margin="5,5"
                            Label="Finansijska kartica"
                            LargeIcon="/Images/icons8-report-file-48.png"
                            SizeMode="large" />
                        <syncfusion:ButtonAdv
                            Grid.Row="1"
                            Width="150"
                            Margin="5,10"
                            Label="Komitenti"
                            LargeIcon="/Images/icons8-customer-48.png"
                            SizeMode="Large" />
                    </Grid>

                </Grid>

            </Border>

        </Grid>

        <Grid Grid.Row="1">

            <Border Margin="0,10" Background="#F7F8F8">

                <syncfusion:SfDataGrid
                    x:Name="tabela"
                    AllowResizingColumns="True"
                    AutoGenerateColumns="False"
                    ColumnSizer="Star"
                    ItemsSource="{Binding UplateIsplate}"
                    SelectedItem="{Binding Transakcija, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    LiveDataUpdateMode="AllowSummaryUpdate"
                    >
                    <syncfusion:SfDataGrid.Columns>

                        <syncfusion:GridTextColumn
                            Width="50"
                            HeaderText="Nalog"
                            MappingName="Nalog" />
                        <syncfusion:GridTextColumn
                            Width="100"
                            HeaderText="Vrsta Naloga"
                            MappingName="VrstaNaloga" />
                        <syncfusion:GridTextColumn
                            Width="100"
                            HeaderText="Datum"
                            MappingName="Datum" />
                        <syncfusion:GridTextColumn
                            Width="100"
                            HeaderText="Konto"
                            MappingName="Konto" />
                        <syncfusion:GridTextColumn
                            Width="100"
                            HeaderText="Sifra"
                            MappingName="Komitent.Sifra" />
                        <syncfusion:GridTextColumn
                            Width="300"
                            HeaderText="Komitent"
                            MappingName="Komitent.Naziv" />
                        <syncfusion:GridTextColumn
                            Width="100"
                            HeaderText="Sifra MT"
                            MappingName="MestoTroska.Prefix" />
                        <syncfusion:GridTextColumn
                            Width="300"
                            HeaderText="Mesto Troska"
                            MappingName="MestoTroska" />
                        <syncfusion:GridTextColumn
                            Width="300"
                            HeaderText="Opis"
                            MappingName="Opis" />

                        <syncfusion:GridTextColumn HeaderText="Uplata" MappingName="Uplata" />
                        <syncfusion:GridTextColumn HeaderText="Isplata" MappingName="Isplata" />

                        <syncfusion:GridCheckBoxSelectorColumn HeaderText="Izabrano" MappingName="IsEditable" />

                    </syncfusion:SfDataGrid.Columns>

                    <syncfusion:SfDataGrid.TableSummaryRows>
                        <syncfusion:GridTableSummaryRow Position="Bottom" ShowSummaryInRow="False">
                            <syncfusion:GridTableSummaryRow.SummaryColumns>
                                
                                <syncfusion:GridSummaryColumn Name="totalUplate" Format="'Ukupno uplaceno: {Sum:c}'" MappingName="Uplata" SummaryType="DoubleAggregate">
                                    
                                </syncfusion:GridSummaryColumn>
                                
                                <syncfusion:GridSummaryColumn Name="totalIsplate" Format="'Ukupno isplaceno: {Sum:c}'" MappingName="Isplata" SummaryType="DoubleAggregate">

                                </syncfusion:GridSummaryColumn>
                                
                            </syncfusion:GridTableSummaryRow.SummaryColumns>
                        </syncfusion:GridTableSummaryRow>
                    </syncfusion:SfDataGrid.TableSummaryRows>

                </syncfusion:SfDataGrid>

            </Border>

        </Grid>

    </Grid>
</UserControl>
